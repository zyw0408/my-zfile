# äº‘ç›˜ç³»ç»Ÿ - å®æˆ˜å¼€å‘æµç¨‹

> ä»0åˆ°1ï¼ŒçœŸå®ç¨‹åºå‘˜çš„ç¼–ç é¡ºåº

## ğŸ“‹ å½“å‰é¡¹ç›®çŠ¶æ€

### åç«¯ (background)
- âœ… Spring Boot 3.5.7 åˆå§‹åŒ–å®Œæˆ
- âœ… Java 21
- âœ… Lombok å·²é…ç½®
- ğŸ“¦ åŒ…å: `com.noname.background`

### å‰ç«¯
- ğŸ“‚ ç©ºæ–‡ä»¶å¤¹ï¼Œå¾…åˆå§‹åŒ–

---

## ğŸ¯ å¼€å‘åŸåˆ™

1. **è‡ªåº•å‘ä¸Š**ï¼šä»åŸºç¡€è®¾æ–½å¼€å§‹ï¼Œé€å±‚å‘ä¸Š
2. **å…ˆåç«¯åå‰ç«¯**ï¼šåç«¯APIå…ˆè¡Œï¼Œå‰ç«¯å¯¹æ¥
3. **MVPä¼˜å…ˆ**ï¼šå…ˆå®ç°æ ¸å¿ƒåŠŸèƒ½ï¼Œå†æ‰©å±•
4. **æŒç»­æµ‹è¯•**ï¼šæ¯å®Œæˆä¸€ä¸ªæ¨¡å—å°±æµ‹è¯•
5. **å¢é‡å¼€å‘**ï¼šå°æ­¥å¿«è·‘ï¼Œå¿«é€Ÿè¿­ä»£

---

## ğŸ“… å®Œæ•´å¼€å‘è·¯çº¿å›¾

```
ç¬¬ä¸€é˜¶æ®µï¼šåœ°åŸºå±‚ï¼ˆDay 1-3ï¼‰
â””â”€â”€ æ•°æ®åº“è®¾è®¡ â†’ é¡¹ç›®é…ç½® â†’ å…¬å…±æ¨¡å—

ç¬¬äºŒé˜¶æ®µï¼šè®¤è¯å±‚ï¼ˆDay 4-6ï¼‰
â””â”€â”€ ç”¨æˆ·å®ä½“ â†’ JWTå·¥å…· â†’ ç™»å½•æ³¨å†Œ

ç¬¬ä¸‰é˜¶æ®µï¼šæ ¸å¿ƒä¸šåŠ¡ï¼ˆDay 7-15ï¼‰
â””â”€â”€ æ–‡ä»¶ä¸Šä¼  â†’ æ–‡ä»¶åˆ—è¡¨ â†’ æ–‡ä»¶æ“ä½œ â†’ æ–‡ä»¶é¢„è§ˆ

ç¬¬å››é˜¶æ®µï¼šå‰ç«¯å¼€å‘ï¼ˆDay 10-18ï¼Œå¯å¹¶è¡Œï¼‰
â””â”€â”€ é¡¹ç›®åˆå§‹åŒ– â†’ ç™»å½•é¡µ â†’ æ–‡ä»¶ç®¡ç†é¡µ

ç¬¬äº”é˜¶æ®µï¼šé«˜çº§åŠŸèƒ½ï¼ˆDay 16-20ï¼‰
â””â”€â”€ æ–‡ä»¶åˆ†äº« â†’ ç®¡ç†åå°

ç¬¬å…­é˜¶æ®µï¼šä¼˜åŒ–æµ‹è¯•ï¼ˆDay 21-25ï¼‰
â””â”€â”€ æ€§èƒ½ä¼˜åŒ– â†’ æµ‹è¯• â†’ éƒ¨ç½²
```

---

## ğŸš€ è¯¦ç»†å¼€å‘æ­¥éª¤

### ã€é˜¶æ®µä¸€ã€‘åœ°åŸºå±‚ - æ‰“å¥½åŸºç¡€ï¼ˆDay 1-3ï¼‰

#### Day 1: æ•°æ®åº“è®¾è®¡ä¸é…ç½®

##### 1.1 åˆ›å»ºæ•°æ®åº“
```sql
-- åœ¨MySQLä¸­æ‰§è¡Œ
CREATE DATABASE cloud_disk CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

##### 1.2 å®Œå–„ pom.xml
**æ–‡ä»¶**: `background/pom.xml`

æ·»åŠ å¿…è¦ä¾èµ–ï¼ˆåœ¨ `<dependencies>` ä¸­æ·»åŠ ï¼‰ï¼š
```xml
<!-- MySQLé©±åŠ¨ -->
<dependency>
    <groupId>com.mysql</groupId>
    <artifactId>mysql-connector-j</artifactId>
    <scope>runtime</scope>
</dependency>

<!-- MyBatis -->
<dependency>
    <groupId>org.mybatis.spring.boot</groupId>
    <artifactId>mybatis-spring-boot-starter</artifactId>
    <version>3.0.3</version>
</dependency>

<!-- Redis -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>

<!-- Spring Security -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-security</artifactId>
</dependency>

<!-- JWT -->
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-api</artifactId>
    <version>0.12.6</version>
</dependency>
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-impl</artifactId>
    <version>0.12.6</version>
    <scope>runtime</scope>
</dependency>
<dependency>
    <groupId>io.jsonwebtoken</groupId>
    <artifactId>jjwt-jackson</artifactId>
    <version>0.12.6</version>
    <scope>runtime</scope>
</dependency>

<!-- Validation -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-validation</artifactId>
</dependency>

<!-- Apache Commons -->
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-lang3</artifactId>
</dependency>
<dependency>
    <groupId>commons-io</groupId>
    <artifactId>commons-io</artifactId>
    <version>2.15.1</version>
</dependency>

<!-- Hutoolå·¥å…·åŒ… -->
<dependency>
    <groupId>cn.hutool</groupId>
    <artifactId>hutool-all</artifactId>
    <version>5.8.25</version>
</dependency>

<!-- Knife4j (Swagger) -->
<dependency>
    <groupId>com.github.xiaoymin</groupId>
    <artifactId>knife4j-openapi3-jakarta-spring-boot-starter</artifactId>
    <version>4.5.0</version>
</dependency>
```

##### 1.3 é…ç½® application.yml
**æ–‡ä»¶**: `background/src/main/resources/application.yml`

åˆ é™¤ `application.properties`ï¼Œåˆ›å»º `application.yml`ï¼š
```yaml
server:
  port: 8080
  servlet:
    context-path: /api

spring:
  application:
    name: cloud-disk
  
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/cloud_disk?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: root
    password: root  # ä¿®æ”¹ä¸ºä½ çš„å¯†ç 
  
  redis:
    host: localhost
    port: 6379
    database: 0
    timeout: 3000
  
  servlet:
    multipart:
      max-file-size: 100MB
      max-request-size: 500MB

mybatis:
  mapper-locations: classpath:mapper/**/*.xml
  type-aliases-package: com.noname.background.module.*.entity
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl

# JWTé…ç½®
jwt:
  secret: cloud-disk-secret-key-must-be-long-enough-at-least-256-bits-long
  expiration: 7200000  # 2å°æ—¶ï¼ˆæ¯«ç§’ï¼‰
  refresh-expiration: 604800000  # 7å¤©ï¼ˆæ¯«ç§’ï¼‰

# æ–‡ä»¶å­˜å‚¨é…ç½®
storage:
  type: local
  local:
    base-path: ./upload
    url-prefix: http://localhost:8080/api/files/preview

# Knife4jé…ç½®
knife4j:
  enable: true
  setting:
    language: zh_cn

logging:
  level:
    com.noname.background: debug
```

#### Day 2: åˆ›å»ºé¡¹ç›®ç»“æ„å’Œå…¬å…±æ¨¡å—

##### 2.1 è°ƒæ•´åŒ…ç»“æ„
åœ¨ `com.noname.background` ä¸‹åˆ›å»ºä»¥ä¸‹åŒ…ç»“æ„ï¼š

```
com.noname.background/
â”œâ”€â”€ common/              # å…¬å…±æ¨¡å—
â”‚   â”œâ”€â”€ config/          # é…ç½®ç±»
â”‚   â”œâ”€â”€ constant/        # å¸¸é‡
â”‚   â”œâ”€â”€ exception/       # å¼‚å¸¸
â”‚   â”œâ”€â”€ result/          # ç»Ÿä¸€å“åº”
â”‚   â””â”€â”€ utils/           # å·¥å…·ç±»
â””â”€â”€ module/              # ä¸šåŠ¡æ¨¡å—
    â”œâ”€â”€ auth/            # è®¤è¯æ¨¡å—ï¼ˆç¬¬äºŒé˜¶æ®µï¼‰
    â”œâ”€â”€ user/            # ç”¨æˆ·æ¨¡å—ï¼ˆç¬¬äºŒé˜¶æ®µï¼‰
    â”œâ”€â”€ file/            # æ–‡ä»¶æ¨¡å—ï¼ˆç¬¬ä¸‰é˜¶æ®µï¼‰
    â””â”€â”€ share/           # åˆ†äº«æ¨¡å—ï¼ˆç¬¬äº”é˜¶æ®µï¼‰
```

##### 2.2 åˆ›å»ºç»Ÿä¸€å“åº”ç±»
**æ–‡ä»¶**: `common/result/Result.java`

```java
package com.noname.background.common.result;

import lombok.Data;

@Data
public class Result<T> {
    private Integer code;
    private String message;
    private T data;
    private Long timestamp;

    public Result() {
        this.timestamp = System.currentTimeMillis();
    }

    public static <T> Result<T> success() {
        Result<T> result = new Result<>();
        result.setCode(200);
        result.setMessage("success");
        return result;
    }

    public static <T> Result<T> success(T data) {
        Result<T> result = new Result<>();
        result.setCode(200);
        result.setMessage("success");
        result.setData(data);
        return result;
    }

    public static <T> Result<T> fail(String message) {
        Result<T> result = new Result<>();
        result.setCode(400);
        result.setMessage(message);
        return result;
    }

    public static <T> Result<T> fail(Integer code, String message) {
        Result<T> result = new Result<>();
        result.setCode(code);
        result.setMessage(message);
        return result;
    }
}
```

##### 2.3 åˆ›å»ºä¸šåŠ¡å¼‚å¸¸ç±»
**æ–‡ä»¶**: `common/exception/BusinessException.java`

```java
package com.noname.background.common.exception;

import lombok.Data;
import lombok.EqualsAndHashCode;

@Data
@EqualsAndHashCode(callSuper = true)
public class BusinessException extends RuntimeException {
    private Integer code;

    public BusinessException(String message) {
        super(message);
        this.code = 400;
    }

    public BusinessException(Integer code, String message) {
        super(message);
        this.code = code;
    }
}
```

##### 2.4 åˆ›å»ºå…¨å±€å¼‚å¸¸å¤„ç†å™¨
**æ–‡ä»¶**: `common/exception/GlobalExceptionHandler.java`

```java
package com.noname.background.common.exception;

import com.noname.background.common.result.Result;
import lombok.extern.slf4j.Slf4j;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.MethodArgumentNotValidException;
import org.springframework.web.bind.annotation.ExceptionHandler;
import org.springframework.web.bind.annotation.RestControllerAdvice;

import java.util.stream.Collectors;

@Slf4j
@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(BusinessException.class)
    public Result<?> handleBusinessException(BusinessException e) {
        log.error("ä¸šåŠ¡å¼‚å¸¸ï¼š{}", e.getMessage());
        return Result.fail(e.getCode(), e.getMessage());
    }

    @ExceptionHandler(MethodArgumentNotValidException.class)
    public Result<?> handleValidationException(MethodArgumentNotValidException e) {
        BindingResult bindingResult = e.getBindingResult();
        String message = bindingResult.getAllErrors()
                .stream()
                .map(error -> error.getDefaultMessage())
                .collect(Collectors.joining(", "));
        log.error("å‚æ•°æ ¡éªŒå¤±è´¥ï¼š{}", message);
        return Result.fail(400, message);
    }

    @ExceptionHandler(Exception.class)
    public Result<?> handleException(Exception e) {
        log.error("ç³»ç»Ÿå¼‚å¸¸ï¼š", e);
        return Result.fail(500, "ç³»ç»Ÿå†…éƒ¨é”™è¯¯");
    }
}
```

##### 2.5 åˆ›å»ºå¸¸é‡ç±»
**æ–‡ä»¶**: `common/constant/ErrorCode.java`

```java
package com.noname.background.common.constant;

public class ErrorCode {
    // ç”¨æˆ·ç›¸å…³ 1000-1999
    public static final int USER_NOT_FOUND = 1001;
    public static final int USER_EXISTS = 1002;
    public static final int USERNAME_OR_PASSWORD_ERROR = 1003;
    public static final int TOKEN_EXPIRED = 1004;
    public static final int TOKEN_INVALID = 1005;

    // æ–‡ä»¶ç›¸å…³ 2000-2999
    public static final int FILE_NOT_FOUND = 2001;
    public static final int FILE_NAME_DUPLICATE = 2002;
    public static final int STORAGE_NOT_ENOUGH = 2003;
    public static final int FILE_TYPE_NOT_ALLOWED = 2004;
    public static final int FILE_SIZE_EXCEED = 2005;
    public static final int FILE_UPLOAD_FAILED = 2006;

    // æƒé™ç›¸å…³ 4000-4999
    public static final int NO_PERMISSION = 4001;
    public static final int OPERATION_FORBIDDEN = 4002;
}
```

##### 2.6 é…ç½®Swaggeræ–‡æ¡£
**æ–‡ä»¶**: `common/config/SwaggerConfig.java`

```java
package com.noname.background.common.config;

import io.swagger.v3.oas.models.OpenAPI;
import io.swagger.v3.oas.models.info.Contact;
import io.swagger.v3.oas.models.info.Info;
import io.swagger.v3.oas.models.info.License;
import io.swagger.v3.oas.models.security.SecurityRequirement;
import io.swagger.v3.oas.models.security.SecurityScheme;
import io.swagger.v3.oas.models.Components;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;

@Configuration
public class SwaggerConfig {

    @Bean
    public OpenAPI customOpenAPI() {
        return new OpenAPI()
                .info(new Info()
                        .title("äº‘ç›˜ç³»ç»Ÿ API æ–‡æ¡£")
                        .version("1.0.0")
                        .description("åŸºäºSpring Boot 3 + Vue 3çš„åœ¨çº¿äº‘ç›˜ç³»ç»Ÿ")
                        .contact(new Contact()
                                .name("å¼€å‘å›¢é˜Ÿ")
                                .email("dev@example.com")
                                .url("https://github.com/yourusername/cloud-disk"))
                        .license(new License()
                                .name("MIT License")
                                .url("https://opensource.org/licenses/MIT")))
                .addSecurityItem(new SecurityRequirement().addList("Bearer Token"))
                .components(new Components()
                        .addSecuritySchemes("Bearer Token",
                                new SecurityScheme()
                                        .name("Authorization")
                                        .type(SecurityScheme.Type.HTTP)
                                        .scheme("bearer")
                                        .bearerFormat("JWT")
                                        .description("è¯·è¾“å…¥JWT Tokenï¼Œæ ¼å¼ï¼šBearer {token}")));
    }
}
```

#### Day 3: æ•°æ®åº“è¡¨åˆ›å»º

##### 3.1 åˆ›å»ºåˆå§‹åŒ–SQLè„šæœ¬
**æ–‡ä»¶**: `background/src/main/resources/db/init.sql`

```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE `sys_user` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ç”¨æˆ·ID',
  `username` VARCHAR(50) NOT NULL COMMENT 'ç”¨æˆ·å',
  `password` VARCHAR(100) NOT NULL COMMENT 'å¯†ç ï¼ˆåŠ å¯†ï¼‰',
  `nickname` VARCHAR(50) DEFAULT NULL COMMENT 'æ˜µç§°',
  `email` VARCHAR(100) DEFAULT NULL COMMENT 'é‚®ç®±',
  `avatar` VARCHAR(255) DEFAULT NULL COMMENT 'å¤´åƒURL',
  `user_type` TINYINT DEFAULT 0 COMMENT 'ç”¨æˆ·ç±»å‹ï¼š0-æ™®é€šç”¨æˆ·ï¼Œ1-ç®¡ç†å‘˜',
  `status` TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€ï¼š0-ç¦ç”¨ï¼Œ1-å¯ç”¨',
  `storage_quota` BIGINT DEFAULT 10737418240 COMMENT 'å­˜å‚¨é…é¢ï¼ˆå­—èŠ‚ï¼‰ï¼Œé»˜è®¤10GB',
  `used_storage` BIGINT DEFAULT 0 COMMENT 'å·²ä½¿ç”¨å­˜å‚¨ï¼ˆå­—èŠ‚ï¼‰',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `deleted` TINYINT DEFAULT 0 COMMENT 'é€»è¾‘åˆ é™¤ï¼š0-æœªåˆ é™¤ï¼Œ1-å·²åˆ é™¤',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_username` (`username`),
  UNIQUE KEY `uk_email` (`email`),
  KEY `idx_status` (`status`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';

-- æ–‡ä»¶ä¿¡æ¯è¡¨
CREATE TABLE `file_info` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'æ–‡ä»¶ID',
  `file_name` VARCHAR(255) NOT NULL COMMENT 'æ–‡ä»¶å',
  `file_path` VARCHAR(1000) NOT NULL COMMENT 'æ–‡ä»¶è·¯å¾„',
  `file_size` BIGINT NOT NULL DEFAULT 0 COMMENT 'æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰',
  `file_type` VARCHAR(50) DEFAULT NULL COMMENT 'æ–‡ä»¶ç±»å‹ï¼ˆæ‰©å±•åï¼‰',
  `content_type` VARCHAR(100) DEFAULT NULL COMMENT 'MIMEç±»å‹',
  `file_md5` VARCHAR(32) DEFAULT NULL COMMENT 'æ–‡ä»¶MD5å€¼',
  `storage_path` VARCHAR(1000) DEFAULT NULL COMMENT 'å®é™…å­˜å‚¨è·¯å¾„',
  `parent_id` BIGINT DEFAULT 0 COMMENT 'çˆ¶æ–‡ä»¶å¤¹IDï¼Œ0è¡¨ç¤ºæ ¹ç›®å½•',
  `is_folder` TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦æ–‡ä»¶å¤¹ï¼š0-å¦ï¼Œ1-æ˜¯',
  `user_id` BIGINT NOT NULL COMMENT 'æ‰€å±ç”¨æˆ·ID',
  `thumbnail_url` VARCHAR(255) DEFAULT NULL COMMENT 'ç¼©ç•¥å›¾URL',
  `download_count` INT DEFAULT 0 COMMENT 'ä¸‹è½½æ¬¡æ•°',
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `deleted` TINYINT DEFAULT 0 COMMENT 'é€»è¾‘åˆ é™¤',
  PRIMARY KEY (`id`),
  KEY `idx_user_parent` (`user_id`, `parent_id`, `deleted`),
  KEY `idx_file_md5` (`file_md5`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ–‡ä»¶ä¿¡æ¯è¡¨';

-- æ’å…¥ç®¡ç†å‘˜è´¦å·ï¼ˆå¯†ç ï¼šadmin123ï¼Œéœ€è¦ç”¨BCryptåŠ å¯†ï¼‰
-- ä¸´æ—¶ä½¿ç”¨æ˜æ–‡ï¼Œåç»­ä¼šä¿®æ”¹ä¸ºåŠ å¯†
INSERT INTO `sys_user` (`username`, `password`, `nickname`, `user_type`, `status`) 
VALUES ('admin', 'admin123', 'ç³»ç»Ÿç®¡ç†å‘˜', 1, 1);
```

**æ‰§è¡ŒSQL**ï¼š
```bash
mysql -u root -p cloud_disk < src/main/resources/db/init.sql
```

---

### ã€é˜¶æ®µäºŒã€‘è®¤è¯å±‚ - å®ç°ç™»å½•æ³¨å†Œï¼ˆDay 4-6ï¼‰

#### Day 4: ç”¨æˆ·æ¨¡å—åŸºç¡€

##### 4.1 åˆ›å»ºç”¨æˆ·å®ä½“
**æ–‡ä»¶**: `module/user/entity/User.java`

```java
package com.noname.background.module.user.entity;

import lombok.Data;
import java.time.LocalDateTime;

@Data
public class User {
    private Long id;
    private String username;
    private String password;
    private String nickname;
    private String email;
    private String avatar;
    private Integer userType;
    private Integer status;
    private Long storageQuota;
    private Long usedStorage;
    private LocalDateTime createTime;
    private LocalDateTime updateTime;
    private Integer deleted;
}
```

##### 4.2 åˆ›å»º UserMapper
**æ–‡ä»¶**: `module/user/mapper/UserMapper.java`

```java
package com.noname.background.module.user.mapper;

import com.noname.background.module.user.entity.User;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;

@Mapper
public interface UserMapper {
    User selectByUsername(@Param("username") String username);
    
    User selectById(@Param("id") Long id);
    
    int insert(User user);
    
    int updateById(User user);
}
```

##### 4.3 åˆ›å»º Mapper XML
**æ–‡ä»¶**: `resources/mapper/user/UserMapper.xml`

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.noname.background.module.user.mapper.UserMapper">
    
    <resultMap id="BaseResultMap" type="com.noname.background.module.user.entity.User">
        <id column="id" property="id"/>
        <result column="username" property="username"/>
        <result column="password" property="password"/>
        <result column="nickname" property="nickname"/>
        <result column="email" property="email"/>
        <result column="avatar" property="avatar"/>
        <result column="user_type" property="userType"/>
        <result column="status" property="status"/>
        <result column="storage_quota" property="storageQuota"/>
        <result column="used_storage" property="usedStorage"/>
        <result column="create_time" property="createTime"/>
        <result column="update_time" property="updateTime"/>
        <result column="deleted" property="deleted"/>
    </resultMap>
    
    <select id="selectByUsername" resultMap="BaseResultMap">
        SELECT * FROM sys_user 
        WHERE username = #{username} AND deleted = 0
    </select>
    
    <select id="selectById" resultMap="BaseResultMap">
        SELECT * FROM sys_user 
        WHERE id = #{id} AND deleted = 0
    </select>
    
    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO sys_user (username, password, nickname, email, user_type, status)
        VALUES (#{username}, #{password}, #{nickname}, #{email}, #{userType}, #{status})
    </insert>
    
    <update id="updateById">
        UPDATE sys_user 
        SET nickname = #{nickname}, email = #{email}, avatar = #{avatar}
        WHERE id = #{id}
    </update>
</mapper>
```

#### Day 5: JWTè®¤è¯å®ç°

##### 5.1 åˆ›å»ºJWTé…ç½®ç±»
**æ–‡ä»¶**: `common/config/JwtProperties.java`

```java
package com.noname.background.common.config;

import lombok.Data;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.stereotype.Component;

@Data
@Component
@ConfigurationProperties(prefix = "jwt")
public class JwtProperties {
    private String secret;
    private Long expiration;
    private Long refreshExpiration;
}
```

##### 5.2 åˆ›å»ºJWTå·¥å…·ç±»
**æ–‡ä»¶**: `common/utils/JwtUtil.java`

```java
package com.noname.background.common.utils;

import com.noname.background.common.config.JwtProperties;
import io.jsonwebtoken.Claims;
import io.jsonwebtoken.Jwts;
import io.jsonwebtoken.security.Keys;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;

import javax.crypto.SecretKey;
import java.nio.charset.StandardCharsets;
import java.util.Date;

@Slf4j
@Component
@RequiredArgsConstructor
public class JwtUtil {

    private final JwtProperties jwtProperties;

    private SecretKey getSecretKey() {
        return Keys.hmacShaKeyFor(jwtProperties.getSecret().getBytes(StandardCharsets.UTF_8));
    }

    /**
     * ç”ŸæˆAccess Token
     */
    public String generateAccessToken(Long userId, String username) {
        Date now = new Date();
        Date expiry = new Date(now.getTime() + jwtProperties.getExpiration());

        return Jwts.builder()
                .subject(String.valueOf(userId))
                .claim("username", username)
                .issuedAt(now)
                .expiration(expiry)
                .signWith(getSecretKey())
                .compact();
    }

    /**
     * ç”ŸæˆRefresh Token
     */
    public String generateRefreshToken(Long userId) {
        Date now = new Date();
        Date expiry = new Date(now.getTime() + jwtProperties.getRefreshExpiration());

        return Jwts.builder()
                .subject(String.valueOf(userId))
                .issuedAt(now)
                .expiration(expiry)
                .signWith(getSecretKey())
                .compact();
    }

    /**
     * éªŒè¯Token
     */
    public boolean validateToken(String token) {
        try {
            Jwts.parser()
                    .verifyWith(getSecretKey())
                    .build()
                    .parseSignedClaims(token);
            return true;
        } catch (Exception e) {
            log.error("TokenéªŒè¯å¤±è´¥: {}", e.getMessage());
            return false;
        }
    }

    /**
     * ä»Tokenè·å–ç”¨æˆ·ID
     */
    public Long getUserIdFromToken(String token) {
        Claims claims = Jwts.parser()
                .verifyWith(getSecretKey())
                .build()
                .parseSignedClaims(token)
                .getPayload();
        return Long.parseLong(claims.getSubject());
    }
}
```

#### Day 6: ç™»å½•æ³¨å†Œæ¥å£

##### 6.1 åˆ›å»ºDTO
**æ–‡ä»¶**: `module/auth/dto/LoginRequest.java`

```java
package com.noname.background.module.auth.dto;

import jakarta.validation.constraints.NotBlank;
import lombok.Data;

@Data
public class LoginRequest {
    @NotBlank(message = "ç”¨æˆ·åä¸èƒ½ä¸ºç©º")
    private String username;
    
    @NotBlank(message = "å¯†ç ä¸èƒ½ä¸ºç©º")
    private String password;
}
```

**æ–‡ä»¶**: `module/auth/dto/LoginResponse.java`

```java
package com.noname.background.module.auth.dto;

import lombok.Data;

@Data
public class LoginResponse {
    private String accessToken;
    private String refreshToken;
    private Long expiresIn;
    private UserInfo userInfo;

    @Data
    public static class UserInfo {
        private Long id;
        private String username;
        private String nickname;
        private String avatar;
        private Integer userType;
    }
}
```

##### 6.2 åˆ›å»ºAuthService
**æ–‡ä»¶**: `module/auth/service/AuthService.java`

```java
package com.noname.background.module.auth.service;

import com.noname.background.common.exception.BusinessException;
import com.noname.background.common.utils.JwtUtil;
import com.noname.background.module.auth.dto.LoginRequest;
import com.noname.background.module.auth.dto.LoginResponse;
import com.noname.background.module.user.entity.User;
import com.noname.background.module.user.mapper.UserMapper;
import lombok.RequiredArgsConstructor;
import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Service;

@Slf4j
@Service
@RequiredArgsConstructor
public class AuthService {

    private final UserMapper userMapper;
    private final JwtUtil jwtUtil;

    public LoginResponse login(LoginRequest request) {
        // æŸ¥è¯¢ç”¨æˆ·
        User user = userMapper.selectByUsername(request.getUsername());
        if (user == null) {
            throw new BusinessException("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
        }

        // éªŒè¯å¯†ç ï¼ˆæš‚æ—¶æ˜æ–‡æ¯”å¯¹ï¼Œåç»­æ”¹ä¸ºBCryptï¼‰
        if (!user.getPassword().equals(request.getPassword())) {
            throw new BusinessException("ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯");
        }

        // æ£€æŸ¥ç”¨æˆ·çŠ¶æ€
        if (user.getStatus() == 0) {
            throw new BusinessException("è´¦å·å·²è¢«ç¦ç”¨");
        }

        // ç”ŸæˆToken
        String accessToken = jwtUtil.generateAccessToken(user.getId(), user.getUsername());
        String refreshToken = jwtUtil.generateRefreshToken(user.getId());

        // æ„é€ å“åº”
        LoginResponse response = new LoginResponse();
        response.setAccessToken(accessToken);
        response.setRefreshToken(refreshToken);
        response.setExpiresIn(7200000L);

        LoginResponse.UserInfo userInfo = new LoginResponse.UserInfo();
        userInfo.setId(user.getId());
        userInfo.setUsername(user.getUsername());
        userInfo.setNickname(user.getNickname());
        userInfo.setAvatar(user.getAvatar());
        userInfo.setUserType(user.getUserType());
        response.setUserInfo(userInfo);

        log.info("ç”¨æˆ·ç™»å½•æˆåŠŸ: {}", user.getUsername());
        return response;
    }
}
```

##### 6.3 åˆ›å»ºAuthControllerï¼ˆå¸¦Swaggeræ³¨è§£ï¼‰
**æ–‡ä»¶**: `module/auth/controller/AuthController.java`

```java
package com.noname.background.module.auth.controller;

import com.noname.background.common.result.Result;
import com.noname.background.module.auth.dto.LoginRequest;
import com.noname.background.module.auth.dto.LoginResponse;
import com.noname.background.module.auth.service.AuthService;
import io.swagger.v3.oas.annotations.Operation;
import io.swagger.v3.oas.annotations.Parameter;
import io.swagger.v3.oas.annotations.tags.Tag;
import jakarta.validation.Valid;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.*;

@Tag(name = "è®¤è¯ç®¡ç†", description = "ç”¨æˆ·ç™»å½•ã€æ³¨å†Œã€Tokenåˆ·æ–°ç­‰æ¥å£")
@RestController
@RequestMapping("/auth")
@RequiredArgsConstructor
public class AuthController {

    private final AuthService authService;

    @Operation(summary = "ç”¨æˆ·ç™»å½•", description = "é€šè¿‡ç”¨æˆ·åå’Œå¯†ç ç™»å½•ç³»ç»Ÿï¼Œè¿”å›JWT Token")
    @PostMapping("/login")
    public Result<LoginResponse> login(
            @Parameter(description = "ç™»å½•ä¿¡æ¯", required = true)
            @Valid @RequestBody LoginRequest request) {
        return Result.success(authService.login(request));
    }

    @Operation(summary = "APIæµ‹è¯•", description = "æµ‹è¯•æ¥å£æ˜¯å¦æ­£å¸¸å·¥ä½œ")
    @GetMapping("/test")
    public Result<String> test() {
        return Result.success("API is working!");
    }
}
```

##### 6.4 é…ç½®CORSï¼ˆæš‚æ—¶å…¨å¼€æ”¾ï¼‰
**æ–‡ä»¶**: `common/config/WebConfig.java`

```java
package com.noname.background.common.config;

import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.CorsRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;

@Configuration
public class WebConfig implements WebMvcConfigurer {

    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedOriginPatterns("*")
                .allowedMethods("*")
                .allowedHeaders("*")
                .allowCredentials(true)
                .maxAge(3600);
    }
}
```

##### 6.5 æš‚æ—¶ç¦ç”¨Spring Security
**æ–‡ä»¶**: `common/config/SecurityConfig.java`

```java
package com.noname.background.common.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.web.SecurityFilterChain;

@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public SecurityFilterChain filterChain(HttpSecurity http) throws Exception {
        http.csrf(csrf -> csrf.disable())
            .authorizeHttpRequests(auth -> auth.anyRequest().permitAll());
        return http.build();
    }
}
```

##### 6.6 è®¿é—®Swaggeræ–‡æ¡£

å¯åŠ¨é¡¹ç›®åï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®APIæ–‡æ¡£ï¼š

**Knife4jå¢å¼ºæ–‡æ¡£**ï¼ˆæ¨èï¼‰ï¼š
```
http://localhost:8080/api/doc.html
```

**SwaggeråŸç”Ÿæ–‡æ¡£**ï¼š
```
http://localhost:8080/api/swagger-ui/index.html
```

**OpenAPI JSON**ï¼š
```
http://localhost:8080/api/v3/api-docs
```

##### 6.7 æµ‹è¯•ç™»å½•æ¥å£

**æ–¹å¼1ï¼šä½¿ç”¨Swagger UIæµ‹è¯•**
1. è®¿é—® `http://localhost:8080/api/doc.html`
2. æ‰¾åˆ°"è®¤è¯ç®¡ç†"æ¨¡å—
3. å±•å¼€"ç”¨æˆ·ç™»å½•"æ¥å£
4. ç‚¹å‡»"è¯•ä¸€ä¸‹"
5. å¡«å…¥å‚æ•°ï¼š
   ```json
   {
     "username": "admin",
     "password": "admin123"
   }
   ```
6. ç‚¹å‡»"æ‰§è¡Œ"æŸ¥çœ‹ç»“æœ

**æ–¹å¼2ï¼šä½¿ç”¨curlæµ‹è¯•**
```bash
# å¯åŠ¨é¡¹ç›®
mvn spring-boot:run

# æµ‹è¯•æ¥å£
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"admin123"}'
```

**é¢„æœŸå“åº”**ï¼š
```json
{
  "code": 200,
  "message": "success",
  "data": {
    "accessToken": "eyJhbGc...",
    "refreshToken": "eyJhbGc...",
    "expiresIn": 7200000,
    "userInfo": {
      "id": 1,
      "username": "admin",
      "nickname": "ç³»ç»Ÿç®¡ç†å‘˜",
      "userType": 1
    }
  },
  "timestamp": 1699000000000
}
```

**æ–¹å¼3ï¼šä½¿ç”¨Postmanæµ‹è¯•**
1. æ–°å»ºPOSTè¯·æ±‚
2. URL: `http://localhost:8080/api/auth/login`
3. Headers: `Content-Type: application/json`
4. Body (raw): 
   ```json
   {
     "username": "admin",
     "password": "admin123"
   }
   ```
5. ç‚¹å‡»Send

---

### ã€é˜¶æ®µä¸‰ã€‘æ ¸å¿ƒä¸šåŠ¡ - æ–‡ä»¶ç®¡ç†ï¼ˆDay 7-15ï¼‰

> **é‡è¦æç¤º**ï¼šè¿™éƒ¨åˆ†å†…å®¹è¾ƒå¤šï¼Œæˆ‘ä¼šå…ˆè§„åˆ’æ•´ä½“æµç¨‹ï¼Œä½ ç¡®è®¤åæˆ‘å†è¯¦ç»†å±•å¼€æ¯ä¸€æ­¥çš„ä»£ç 

#### Day 7-8: æ–‡ä»¶ä¸Šä¼ 
- åˆ›å»ºæ–‡ä»¶å®ä½“å’ŒMapper
- å®ç°æœ¬åœ°å­˜å‚¨æœåŠ¡
- å®ç°æ–‡ä»¶ä¸Šä¼ æ¥å£ï¼ˆå•æ–‡ä»¶ï¼‰
- å®ç°MD5è®¡ç®—å’Œç§’ä¼ æ£€æŸ¥
- æµ‹è¯•ä¸Šä¼ åŠŸèƒ½

#### Day 9-10: æ–‡ä»¶åˆ—è¡¨å’ŒæŸ¥è¯¢
- å®ç°æ–‡ä»¶åˆ—è¡¨æ¥å£ï¼ˆæ”¯æŒåˆ†é¡µï¼‰
- å®ç°æ–‡ä»¶è¯¦æƒ…æ¥å£
- å®ç°æ–‡ä»¶æœç´¢æ¥å£
- æ·»åŠ é¢åŒ…å±‘å¯¼èˆªæ”¯æŒ

#### Day 11-12: æ–‡ä»¶æ“ä½œ
- å®ç°æ–‡ä»¶ä¸‹è½½
- å®ç°æ–‡ä»¶åˆ é™¤ï¼ˆé€»è¾‘åˆ é™¤ï¼‰
- å®ç°æ–‡ä»¶é‡å‘½å
- å®ç°æ–‡ä»¶ç§»åŠ¨
- å®ç°åˆ›å»ºæ–‡ä»¶å¤¹

#### Day 13-14: æ–‡ä»¶é¢„è§ˆ
- å®ç°å›¾ç‰‡é¢„è§ˆ
- å®ç°æ–‡æœ¬æ–‡ä»¶é¢„è§ˆ
- é›†æˆè§†é¢‘æ’­æ”¾
- ï¼ˆPDFç­‰é«˜çº§é¢„è§ˆå¯åç»­æ‰©å±•ï¼‰

#### Day 15: ç”¨æˆ·å­˜å‚¨ç®¡ç†
- å®ç°å­˜å‚¨ç©ºé—´è®¡ç®—
- å®ç°é…é¢æ£€æŸ¥
- æ·»åŠ ç”¨æˆ·ä¿¡æ¯æ¥å£

---

### ã€é˜¶æ®µå››ã€‘å‰ç«¯å¼€å‘ï¼ˆDay 10-18ï¼Œå¯ä¸åç«¯å¹¶è¡Œï¼‰

#### Day 10-11: å‰ç«¯é¡¹ç›®åˆå§‹åŒ–
```bash
cd frontend
pnpm create vite cloud-disk-frontend --template vue-ts
cd cloud-disk-frontend
pnpm install
pnpm add element-plus axios pinia vue-router
pnpm add -D @types/node
```

#### Day 12-13: ç™»å½•æ³¨å†Œé¡µé¢
- åˆ›å»ºç™»å½•é¡µé¢
- å°è£…axiosè¯·æ±‚
- å®ç°çŠ¶æ€ç®¡ç†
- å®ç°è·¯ç”±å®ˆå«

#### Day 14-16: æ–‡ä»¶ç®¡ç†é¡µé¢
- æ–‡ä»¶åˆ—è¡¨å±•ç¤º
- æ–‡ä»¶ä¸Šä¼ ç»„ä»¶
- æ–‡ä»¶æ“ä½œåŠŸèƒ½
- é¢åŒ…å±‘å¯¼èˆª

#### Day 17-18: é¡µé¢ä¼˜åŒ–
- æ ·å¼ç¾åŒ–
- äº¤äº’ä¼˜åŒ–
- é”™è¯¯å¤„ç†

---

### ã€é˜¶æ®µäº”ã€‘é«˜çº§åŠŸèƒ½ï¼ˆDay 16-20ï¼‰

#### Day 16-17: æ–‡ä»¶åˆ†äº«
- æ•°æ®åº“è¡¨åˆ›å»º
- åˆ†äº«ç”Ÿæˆæ¥å£
- åˆ†äº«è®¿é—®æ¥å£
- äºŒç»´ç ç”Ÿæˆ

#### Day 18-20: ç®¡ç†åå°
- ç”¨æˆ·ç®¡ç†
- æ–‡ä»¶ç»Ÿè®¡
- ç³»ç»Ÿè®¾ç½®

---

### ã€é˜¶æ®µå…­ã€‘ä¼˜åŒ–æµ‹è¯•ï¼ˆDay 21-25ï¼‰

#### Day 21-22: åŠŸèƒ½å®Œå–„
- å¯†ç BCryptåŠ å¯†
- å®Œå–„JWTæ‹¦æˆªå™¨
- å®Œå–„æƒé™æ§åˆ¶
- æ–‡ä»¶ç±»å‹æ£€æŸ¥

#### Day 23: æ€§èƒ½ä¼˜åŒ–
- æ·»åŠ Redisç¼“å­˜
- æ•°æ®åº“ç´¢å¼•ä¼˜åŒ–
- æ¥å£æ€§èƒ½æµ‹è¯•

#### Day 24: æµ‹è¯•
- å•å…ƒæµ‹è¯•
- æ¥å£æµ‹è¯•
- å‰ç«¯æµ‹è¯•

#### Day 25: éƒ¨ç½²
- Dockeré…ç½®
- éƒ¨ç½²æ–‡æ¡£
- é¡¹ç›®æ–‡æ¡£æ•´ç†

---

## âœ… å½“å‰ä»»åŠ¡ï¼šç«‹å³å¼€å§‹

### ğŸ¯ ç°åœ¨å°±å¯ä»¥åšçš„äº‹æƒ…ï¼š

1. **æ›´æ–° pom.xml**ï¼ˆæ·»åŠ ä¾èµ–ï¼‰
2. **åˆ›å»º application.yml**ï¼ˆé…ç½®æ–‡ä»¶ï¼‰
3. **åˆ›å»ºæ•°æ®åº“**ï¼ˆæ‰§è¡ŒSQLï¼‰
4. **åˆ›å»ºé¡¹ç›®ç»“æ„**ï¼ˆåŒ…å’Œç±»ï¼‰
5. **é…ç½®Swaggeræ–‡æ¡£**ï¼ˆè‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£ï¼‰
6. **å®ç°ç™»å½•æ¥å£**ï¼ˆç¬¬ä¸€ä¸ªå¯æµ‹è¯•çš„åŠŸèƒ½ï¼‰

### ğŸ“š Swaggerä½¿ç”¨è¯´æ˜

å®ŒæˆDay 1-6åï¼Œä½ å°†è·å¾—ï¼š

**1. è‡ªåŠ¨ç”Ÿæˆçš„APIæ–‡æ¡£**
- è®¿é—® `http://localhost:8080/api/doc.html` æŸ¥çœ‹ç²¾ç¾çš„APIæ–‡æ¡£
- æ‰€æœ‰æ¥å£è‡ªåŠ¨åˆ†ç»„ã€è‡ªåŠ¨ç”Ÿæˆå‚æ•°è¯´æ˜
- æ”¯æŒåœ¨çº¿æµ‹è¯•ï¼Œæ— éœ€Postman

**2. Swaggeræ³¨è§£ä½¿ç”¨ç¤ºä¾‹**
```java
@Tag(name = "æ¨¡å—åç§°", description = "æ¨¡å—æè¿°")
public class YourController {
    
    @Operation(summary = "æ¥å£æ‘˜è¦", description = "è¯¦ç»†æè¿°")
    @PostMapping("/xxx")
    public Result<String> xxx(
        @Parameter(description = "å‚æ•°è¯´æ˜") @RequestBody Request req) {
        // ...
    }
}
```

**3. JWT Tokenæµ‹è¯•**
- åœ¨Swagger UIä¸­ç‚¹å‡»å³ä¸Šè§’"Authorize"æŒ‰é’®
- è¾“å…¥ï¼š`Bearer {ä½ çš„token}`
- å³å¯æµ‹è¯•éœ€è¦è®¤è¯çš„æ¥å£

---

## ğŸ“ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

**è¯·å‘Šè¯‰æˆ‘ï¼š**
1. ä½ æ˜¯å¦å·²ç»å®‰è£…äº†MySQLå’ŒRedisï¼Ÿ
2. æ˜¯å¦å¸Œæœ›æˆ‘ç«‹å³ç”ŸæˆDay 1-6çš„å®Œæ•´ä»£ç ï¼Ÿ
3. è¿˜æ˜¯ä½ å¸Œæœ›ä¸€æ­¥ä¸€æ­¥æ¥ï¼Œæ¯å®Œæˆä¸€æ­¥æˆ‘ä»¬å†è¿›è¡Œä¸‹ä¸€æ­¥ï¼Ÿ

æˆ‘å»ºè®®æˆ‘ä»¬**å…ˆå®ŒæˆDay 1-6**ï¼Œå®ç°ä¸€ä¸ª**å¯ä»¥ç™»å½•çš„åç«¯API**ï¼Œè¿™æ ·ä½ å°±æœ‰äº†ä¸€ä¸ªsolidçš„åŸºç¡€ï¼Œåç»­å¼€å‘å°±ä¼šå¾ˆé¡ºåˆ©äº†ï¼

æ€ä¹ˆæ ·ï¼Œè¦ä¸è¦æˆ‘ç°åœ¨å°±å¸®ä½ æŠŠDay 1-6çš„æ‰€æœ‰ä»£ç å’Œæ­¥éª¤è¯¦ç»†åˆ—å‡ºæ¥ï¼Ÿ ğŸš€

