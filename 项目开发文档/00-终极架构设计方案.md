# äº‘ç›˜ç³»ç»Ÿ - ç»ˆææ¶æ„è®¾è®¡æ–¹æ¡ˆ

> åŸºäºDDD + å…¬å…±å­—æ®µè®¾è®¡ + å‰åç«¯åˆ†ç¦»çš„ä¼ä¸šçº§æ¶æ„

## ğŸ“‹ ç›®å½•
- [æ¶æ„æ ¸å¿ƒç†å¿µ](#æ¶æ„æ ¸å¿ƒç†å¿µ)
- [DDDé¢†åŸŸé©±åŠ¨è®¾è®¡](#dddé¢†åŸŸé©±åŠ¨è®¾è®¡)
- [å…¬å…±å­—æ®µæ¨¡å—è®¾è®¡](#å…¬å…±å­—æ®µæ¨¡å—è®¾è®¡)
- [å‰åç«¯åˆ†ç¦»æ–¹æ¡ˆ](#å‰åç«¯åˆ†ç¦»æ–¹æ¡ˆ)
- [å®Œæ•´é¡¹ç›®ç»“æ„](#å®Œæ•´é¡¹ç›®ç»“æ„)
- [å¼€å‘è§„èŒƒ](#å¼€å‘è§„èŒƒ)

---

## ğŸ¯ æ¶æ„æ ¸å¿ƒç†å¿µ

### 1. DDDé¢†åŸŸé©±åŠ¨è®¾è®¡
- **åˆ†å±‚æ¸…æ™°**ï¼šæ¥å£å±‚ â†’ åº”ç”¨å±‚ â†’ é¢†åŸŸå±‚ â†’ åŸºç¡€è®¾æ–½å±‚
- **é¢†åŸŸæ¨¡å‹**ï¼šä»¥ä¸šåŠ¡ä¸ºä¸­å¿ƒï¼Œè€Œéæ•°æ®åº“ä¸ºä¸­å¿ƒ
- **èšåˆæ ¹**ï¼šä¿è¯é¢†åŸŸå¯¹è±¡çš„ä¸€è‡´æ€§
- **å€¼å¯¹è±¡**ï¼šä¸å¯å˜å¯¹è±¡ï¼Œä½“ç°ä¸šåŠ¡æ¦‚å¿µ

### 2. å…¬å…±å­—æ®µè®¾è®¡
- **åŸºç±»æŠ½è±¡**ï¼šæ‰€æœ‰å®ä½“ç»§æ‰¿å…¬å…±å­—æ®µåŸºç±»
- **å®¡è®¡å­—æ®µ**ï¼šåˆ›å»ºäººã€åˆ›å»ºæ—¶é—´ã€æ›´æ–°äººã€æ›´æ–°æ—¶é—´
- **é€»è¾‘åˆ é™¤**ï¼šdeletedå­—æ®µï¼Œè½¯åˆ é™¤
- **ä¹è§‚é”**ï¼šversionå­—æ®µï¼Œé˜²æ­¢å¹¶å‘å†²çª

### 3. å‰åç«¯åˆ†ç¦»
- **RESTful API**ï¼šç»Ÿä¸€çš„æ¥å£è§„èŒƒ
- **JWTè®¤è¯**ï¼šæ— çŠ¶æ€çš„è®¤è¯æ–¹æ¡ˆ
- **CORSè·¨åŸŸ**ï¼šå…è®¸å‰ç«¯ç‹¬ç«‹éƒ¨ç½²
- **Swaggeræ–‡æ¡£**ï¼šè‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£

### 4. å¼€å‘è§„èŒƒ
- **ç»Ÿä¸€å“åº”**ï¼šResult<T>åŒ…è£…æ‰€æœ‰å“åº”
- **ç»Ÿä¸€å¼‚å¸¸**ï¼šBusinessExceptionä¸šåŠ¡å¼‚å¸¸
- **å‚æ•°æ ¡éªŒ**ï¼šJSR-303æ³¨è§£æ ¡éªŒ
- **æ—¥å¿—è§„èŒƒ**ï¼šSLF4j + Logback

---

## ğŸ—ï¸ DDDé¢†åŸŸé©±åŠ¨è®¾è®¡

### 1. åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Interface Layer (æ¥å£å±‚)            â”‚
â”‚  Controller / REST API / WebSocket              â”‚
â”‚  - æ¥æ”¶è¯·æ±‚ï¼Œå‚æ•°æ ¡éªŒ                            â”‚
â”‚  - è°ƒç”¨åº”ç”¨æœåŠ¡                                  â”‚
â”‚  - è¿”å›å“åº”                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Application Layer (åº”ç”¨å±‚)            â”‚
â”‚  Service / Application Service                  â”‚
â”‚  - ç¼–æ’é¢†åŸŸå¯¹è±¡                                  â”‚
â”‚  - å¤„ç†äº‹åŠ¡                                      â”‚
â”‚  - è°ƒç”¨é¢†åŸŸæœåŠ¡                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Domain Layer (é¢†åŸŸå±‚)               â”‚
â”‚  Entity / Value Object / Domain Service         â”‚
â”‚  - æ ¸å¿ƒä¸šåŠ¡é€»è¾‘                                  â”‚
â”‚  - é¢†åŸŸæ¨¡å‹                                      â”‚
â”‚  - ä¸šåŠ¡è§„åˆ™                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Infrastructure Layer (åŸºç¡€è®¾æ–½å±‚)        â”‚
â”‚  Repository / Mapper / Config / Utils           â”‚
â”‚  - æ•°æ®æŒä¹…åŒ–                                    â”‚
â”‚  - å¤–éƒ¨æœåŠ¡é›†æˆ                                  â”‚
â”‚  - æŠ€æœ¯å®ç°                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. é¢†åŸŸåˆ’åˆ†

#### 2.1 ç”¨æˆ·åŸŸ (User Domain)
**èšåˆæ ¹**: User
**å®ä½“**: User
**å€¼å¯¹è±¡**: UserType, UserStatus
**é¢†åŸŸæœåŠ¡**: UserDomainService
**ä»“å‚¨**: UserRepository

#### 2.2 æ–‡ä»¶åŸŸ (File Domain)
**èšåˆæ ¹**: FileInfo
**å®ä½“**: FileInfo, Folder
**å€¼å¯¹è±¡**: FileType, FilePath, FileSize
**é¢†åŸŸæœåŠ¡**: FileDomainService, StorageDomainService
**ä»“å‚¨**: FileRepository

#### 2.3 åˆ†äº«åŸŸ (Share Domain)
**èšåˆæ ¹**: FileShare
**å®ä½“**: FileShare
**å€¼å¯¹è±¡**: ShareCode, SharePassword, ShareStatus
**é¢†åŸŸæœåŠ¡**: ShareDomainService
**ä»“å‚¨**: ShareRepository

### 3. é¡¹ç›®ç»“æ„ï¼ˆDDDé£æ ¼ï¼‰

```
com.noname.background/
â”œâ”€â”€ interface/                      # æ¥å£å±‚
â”‚   â”œâ”€â”€ controller/                 # RESTæ§åˆ¶å™¨
â”‚   â”‚   â”œâ”€â”€ AuthController.java
â”‚   â”‚   â”œâ”€â”€ FileController.java
â”‚   â”‚   â””â”€â”€ ShareController.java
â”‚   â””â”€â”€ dto/                        # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚       â”œâ”€â”€ request/                # è¯·æ±‚DTO
â”‚       â”‚   â”œâ”€â”€ LoginRequest.java
â”‚       â”‚   â””â”€â”€ FileUploadRequest.java
â”‚       â””â”€â”€ response/               # å“åº”DTO
â”‚           â”œâ”€â”€ LoginResponse.java
â”‚           â””â”€â”€ FileResponse.java
â”‚
â”œâ”€â”€ application/                    # åº”ç”¨å±‚
â”‚   â”œâ”€â”€ service/                    # åº”ç”¨æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ AuthService.java
â”‚   â”‚   â”œâ”€â”€ FileService.java
â”‚   â”‚   â””â”€â”€ ShareService.java
â”‚   â””â”€â”€ assembler/                  # è£…é…å™¨ï¼ˆDTOä¸é¢†åŸŸå¯¹è±¡è½¬æ¢ï¼‰
â”‚       â”œâ”€â”€ UserAssembler.java
â”‚       â””â”€â”€ FileAssembler.java
â”‚
â”œâ”€â”€ domain/                         # é¢†åŸŸå±‚
â”‚   â”œâ”€â”€ user/                       # ç”¨æˆ·åŸŸ
â”‚   â”‚   â”œâ”€â”€ entity/                 # å®ä½“
â”‚   â”‚   â”‚   â””â”€â”€ User.java
â”‚   â”‚   â”œâ”€â”€ valueobject/            # å€¼å¯¹è±¡
â”‚   â”‚   â”‚   â”œâ”€â”€ UserType.java
â”‚   â”‚   â”‚   â””â”€â”€ UserStatus.java
â”‚   â”‚   â”œâ”€â”€ service/                # é¢†åŸŸæœåŠ¡
â”‚   â”‚   â”‚   â””â”€â”€ UserDomainService.java
â”‚   â”‚   â””â”€â”€ repository/             # ä»“å‚¨æ¥å£
â”‚   â”‚       â””â”€â”€ UserRepository.java
â”‚   â”‚
â”‚   â”œâ”€â”€ file/                       # æ–‡ä»¶åŸŸ
â”‚   â”‚   â”œâ”€â”€ entity/
â”‚   â”‚   â”‚   â”œâ”€â”€ FileInfo.java
â”‚   â”‚   â”‚   â””â”€â”€ Folder.java
â”‚   â”‚   â”œâ”€â”€ valueobject/
â”‚   â”‚   â”‚   â”œâ”€â”€ FileType.java
â”‚   â”‚   â”‚   â”œâ”€â”€ FilePath.java
â”‚   â”‚   â”‚   â””â”€â”€ FileSize.java
â”‚   â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”‚   â”œâ”€â”€ FileDomainService.java
â”‚   â”‚   â”‚   â””â”€â”€ StorageDomainService.java
â”‚   â”‚   â””â”€â”€ repository/
â”‚   â”‚       â””â”€â”€ FileRepository.java
â”‚   â”‚
â”‚   â””â”€â”€ share/                      # åˆ†äº«åŸŸ
â”‚       â”œâ”€â”€ entity/
â”‚       â”‚   â””â”€â”€ FileShare.java
â”‚       â”œâ”€â”€ valueobject/
â”‚       â”‚   â”œâ”€â”€ ShareCode.java
â”‚       â”‚   â””â”€â”€ ShareStatus.java
â”‚       â”œâ”€â”€ service/
â”‚       â”‚   â””â”€â”€ ShareDomainService.java
â”‚       â””â”€â”€ repository/
â”‚           â””â”€â”€ ShareRepository.java
â”‚
â”œâ”€â”€ infrastructure/                 # åŸºç¡€è®¾æ–½å±‚
â”‚   â”œâ”€â”€ persistence/                # æŒä¹…åŒ–
â”‚   â”‚   â”œâ”€â”€ mapper/                 # MyBatis Mapper
â”‚   â”‚   â”‚   â”œâ”€â”€ UserMapper.java
â”‚   â”‚   â”‚   â””â”€â”€ FileMapper.java
â”‚   â”‚   â””â”€â”€ repository/             # ä»“å‚¨å®ç°
â”‚   â”‚       â”œâ”€â”€ UserRepositoryImpl.java
â”‚   â”‚       â””â”€â”€ FileRepositoryImpl.java
â”‚   â”‚
â”‚   â”œâ”€â”€ storage/                    # æ–‡ä»¶å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ StorageService.java
â”‚   â”‚   â”œâ”€â”€ LocalStorageService.java
â”‚   â”‚   â””â”€â”€ OssStorageService.java
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                     # é…ç½®
â”‚   â”‚   â”œâ”€â”€ SecurityConfig.java
â”‚   â”‚   â”œâ”€â”€ SwaggerConfig.java
â”‚   â”‚   â””â”€â”€ MyBatisConfig.java
â”‚   â”‚
â”‚   â””â”€â”€ common/                     # å…¬å…±ç»„ä»¶
â”‚       â”œâ”€â”€ base/                   # åŸºç±»
â”‚       â”œâ”€â”€ constant/               # å¸¸é‡
â”‚       â”œâ”€â”€ exception/              # å¼‚å¸¸
â”‚       â”œâ”€â”€ result/                 # å“åº”
â”‚       â””â”€â”€ utils/                  # å·¥å…·
â”‚
â””â”€â”€ BackgroundApplication.java      # å¯åŠ¨ç±»
```

---

## ğŸ“¦ å…¬å…±å­—æ®µæ¨¡å—è®¾è®¡

### 1. åŸºç±»è®¾è®¡

#### 1.1 åŸºç¡€å®ä½“ç±»
**æ–‡ä»¶**: `infrastructure/common/base/BaseEntity.java`

```java
package com.noname.background.infrastructure.common.base;

import com.fasterxml.jackson.annotation.JsonFormat;
import io.swagger.v3.oas.annotations.media.Schema;
import lombok.Data;

import java.io.Serializable;
import java.time.LocalDateTime;

/**
 * åŸºç¡€å®ä½“ç±» - æ‰€æœ‰å®ä½“çš„çˆ¶ç±»
 * åŒ…å«å…¬å…±å­—æ®µï¼šä¸»é”®ã€åˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´ã€é€»è¾‘åˆ é™¤æ ‡è¯†
 */
@Data
@Schema(description = "åŸºç¡€å®ä½“")
public abstract class BaseEntity implements Serializable {

    private static final long serialVersionUID = 1L;

    @Schema(description = "ä¸»é”®ID")
    private Long id;

    @Schema(description = "åˆ›å»ºæ—¶é—´")
    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    private LocalDateTime createTime;

    @Schema(description = "æ›´æ–°æ—¶é—´")
    @JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss")
    private LocalDateTime updateTime;

    @Schema(description = "é€»è¾‘åˆ é™¤ï¼š0-æœªåˆ é™¤ï¼Œ1-å·²åˆ é™¤")
    private Integer deleted;
}
```

#### 1.2 å®¡è®¡å®ä½“ç±»ï¼ˆå¸¦åˆ›å»ºäººã€æ›´æ–°äººï¼‰
**æ–‡ä»¶**: `infrastructure/common/base/AuditEntity.java`

```java
package com.noname.background.infrastructure.common.base;

import io.swagger.v3.oas.annotations.media.Schema;
import lombok.Data;
import lombok.EqualsAndHashCode;

/**
 * å®¡è®¡å®ä½“ç±» - éœ€è¦è®°å½•æ“ä½œäººçš„å®ä½“
 * åŒ…å«åˆ›å»ºäººã€æ›´æ–°äººå­—æ®µ
 */
@Data
@EqualsAndHashCode(callSuper = true)
@Schema(description = "å®¡è®¡å®ä½“")
public abstract class AuditEntity extends BaseEntity {

    @Schema(description = "åˆ›å»ºäººID")
    private Long createBy;

    @Schema(description = "åˆ›å»ºäººåç§°")
    private String createName;

    @Schema(description = "æ›´æ–°äººID")
    private Long updateBy;

    @Schema(description = "æ›´æ–°äººåç§°")
    private String updateName;
}
```

#### 1.3 ç‰ˆæœ¬å®ä½“ç±»ï¼ˆå¸¦ä¹è§‚é”ï¼‰
**æ–‡ä»¶**: `infrastructure/common/base/VersionEntity.java`

```java
package com.noname.background.infrastructure.common.base;

import io.swagger.v3.oas.annotations.media.Schema;
import lombok.Data;
import lombok.EqualsAndHashCode;

/**
 * ç‰ˆæœ¬å®ä½“ç±» - éœ€è¦ä¹è§‚é”æ§åˆ¶çš„å®ä½“
 * åŒ…å«ç‰ˆæœ¬å·å­—æ®µ
 */
@Data
@EqualsAndHashCode(callSuper = true)
@Schema(description = "ç‰ˆæœ¬å®ä½“")
public abstract class VersionEntity extends AuditEntity {

    @Schema(description = "ç‰ˆæœ¬å·ï¼ˆä¹è§‚é”ï¼‰")
    private Integer version;
}
```

### 2. MyBatisè‡ªåŠ¨å¡«å……

#### 2.1 å…ƒæ•°æ®å¤„ç†å™¨
**æ–‡ä»¶**: `infrastructure/config/MyBatisMetaObjectHandler.java`

```java
package com.noname.background.infrastructure.config;

import com.baomidou.mybatisplus.core.handlers.MetaObjectHandler;
import lombok.extern.slf4j.Slf4j;
import org.apache.ibatis.reflection.MetaObject;
import org.springframework.stereotype.Component;

import java.time.LocalDateTime;

/**
 * MyBatis-Plus å…ƒæ•°æ®å¤„ç†å™¨
 * è‡ªåŠ¨å¡«å……åˆ›å»ºæ—¶é—´ã€æ›´æ–°æ—¶é—´ç­‰å­—æ®µ
 */
@Slf4j
@Component
public class MyBatisMetaObjectHandler implements MetaObjectHandler {

    @Override
    public void insertFill(MetaObject metaObject) {
        log.debug("å¼€å§‹æ’å…¥å¡«å……...");
        
        // å¡«å……åˆ›å»ºæ—¶é—´
        this.strictInsertFill(metaObject, "createTime", LocalDateTime.class, LocalDateTime.now());
        
        // å¡«å……æ›´æ–°æ—¶é—´
        this.strictInsertFill(metaObject, "updateTime", LocalDateTime.class, LocalDateTime.now());
        
        // å¡«å……é€»è¾‘åˆ é™¤æ ‡è¯†
        this.strictInsertFill(metaObject, "deleted", Integer.class, 0);
        
        // å¡«å……åˆ›å»ºäººï¼ˆä»ä¸Šä¸‹æ–‡è·å–å½“å‰ç”¨æˆ·ï¼‰
        Long currentUserId = getCurrentUserId();
        if (currentUserId != null) {
            this.strictInsertFill(metaObject, "createBy", Long.class, currentUserId);
            this.strictInsertFill(metaObject, "updateBy", Long.class, currentUserId);
        }
        
        // å¡«å……ç‰ˆæœ¬å·
        this.strictInsertFill(metaObject, "version", Integer.class, 0);
    }

    @Override
    public void updateFill(MetaObject metaObject) {
        log.debug("å¼€å§‹æ›´æ–°å¡«å……...");
        
        // å¡«å……æ›´æ–°æ—¶é—´
        this.strictUpdateFill(metaObject, "updateTime", LocalDateTime.class, LocalDateTime.now());
        
        // å¡«å……æ›´æ–°äºº
        Long currentUserId = getCurrentUserId();
        if (currentUserId != null) {
            this.strictUpdateFill(metaObject, "updateBy", Long.class, currentUserId);
        }
    }

    /**
     * è·å–å½“å‰ç™»å½•ç”¨æˆ·ID
     * ä»SecurityContextæˆ–ThreadLocalä¸­è·å–
     */
    private Long getCurrentUserId() {
        // TODO: ä»Securityä¸Šä¸‹æ–‡è·å–å½“å‰ç”¨æˆ·
        // SecurityContext.getCurrentUserId();
        return null;
    }
}
```

### 3. å®ä½“ä½¿ç”¨ç¤ºä¾‹

#### 3.1 Userå®ä½“
```java
package com.noname.background.domain.user.entity;

import com.noname.background.infrastructure.common.base.BaseEntity;
import io.swagger.v3.oas.annotations.media.Schema;
import lombok.Data;
import lombok.EqualsAndHashCode;

@Data
@EqualsAndHashCode(callSuper = true)
@Schema(description = "ç”¨æˆ·å®ä½“")
public class User extends BaseEntity {
    
    @Schema(description = "ç”¨æˆ·å")
    private String username;
    
    @Schema(description = "å¯†ç ")
    private String password;
    
    @Schema(description = "æ˜µç§°")
    private String nickname;
    
    @Schema(description = "é‚®ç®±")
    private String email;
    
    // å…¶ä»–å­—æ®µ...
    // id, createTime, updateTime, deleted è‡ªåŠ¨ç»§æ‰¿
}
```

#### 3.2 FileInfoå®ä½“
```java
package com.noname.background.domain.file.entity;

import com.noname.background.infrastructure.common.base.AuditEntity;
import io.swagger.v3.oas.annotations.media.Schema;
import lombok.Data;
import lombok.EqualsAndHashCode;

@Data
@EqualsAndHashCode(callSuper = true)
@Schema(description = "æ–‡ä»¶ä¿¡æ¯å®ä½“")
public class FileInfo extends AuditEntity {
    
    @Schema(description = "æ–‡ä»¶å")
    private String fileName;
    
    @Schema(description = "æ–‡ä»¶è·¯å¾„")
    private String filePath;
    
    @Schema(description = "æ–‡ä»¶å¤§å°")
    private Long fileSize;
    
    // å…¶ä»–å­—æ®µ...
    // id, createTime, updateTime, deleted, createBy, updateBy è‡ªåŠ¨ç»§æ‰¿
}
```

### 4. æ•°æ®åº“è¡¨è®¾è®¡ï¼ˆå¸¦å…¬å…±å­—æ®µï¼‰

```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE `sys_user` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `username` VARCHAR(50) NOT NULL COMMENT 'ç”¨æˆ·å',
  `password` VARCHAR(100) NOT NULL COMMENT 'å¯†ç ',
  `nickname` VARCHAR(50) DEFAULT NULL COMMENT 'æ˜µç§°',
  `email` VARCHAR(100) DEFAULT NULL COMMENT 'é‚®ç®±',
  `avatar` VARCHAR(255) DEFAULT NULL COMMENT 'å¤´åƒ',
  `user_type` TINYINT DEFAULT 0 COMMENT 'ç”¨æˆ·ç±»å‹',
  `status` TINYINT DEFAULT 1 COMMENT 'çŠ¶æ€',
  `storage_quota` BIGINT DEFAULT 10737418240 COMMENT 'å­˜å‚¨é…é¢',
  `used_storage` BIGINT DEFAULT 0 COMMENT 'å·²ä½¿ç”¨å­˜å‚¨',
  -- å…¬å…±å­—æ®µ
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `deleted` TINYINT DEFAULT 0 COMMENT 'é€»è¾‘åˆ é™¤',
  PRIMARY KEY (`id`),
  UNIQUE KEY `uk_username` (`username`),
  KEY `idx_deleted` (`deleted`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='ç”¨æˆ·è¡¨';

-- æ–‡ä»¶ä¿¡æ¯è¡¨
CREATE TABLE `file_info` (
  `id` BIGINT NOT NULL AUTO_INCREMENT COMMENT 'ä¸»é”®ID',
  `file_name` VARCHAR(255) NOT NULL COMMENT 'æ–‡ä»¶å',
  `file_path` VARCHAR(1000) NOT NULL COMMENT 'æ–‡ä»¶è·¯å¾„',
  `file_size` BIGINT NOT NULL DEFAULT 0 COMMENT 'æ–‡ä»¶å¤§å°',
  `file_type` VARCHAR(50) DEFAULT NULL COMMENT 'æ–‡ä»¶ç±»å‹',
  `file_md5` VARCHAR(32) DEFAULT NULL COMMENT 'æ–‡ä»¶MD5',
  `user_id` BIGINT NOT NULL COMMENT 'æ‰€å±ç”¨æˆ·',
  `parent_id` BIGINT DEFAULT 0 COMMENT 'çˆ¶æ–‡ä»¶å¤¹',
  `is_folder` TINYINT DEFAULT 0 COMMENT 'æ˜¯å¦æ–‡ä»¶å¤¹',
  -- å…¬å…±å­—æ®µï¼ˆå®¡è®¡ï¼‰
  `create_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  `update_time` DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
  `create_by` BIGINT DEFAULT NULL COMMENT 'åˆ›å»ºäºº',
  `update_by` BIGINT DEFAULT NULL COMMENT 'æ›´æ–°äºº',
  `deleted` TINYINT DEFAULT 0 COMMENT 'é€»è¾‘åˆ é™¤',
  -- ä¹è§‚é”ï¼ˆé‡è¦æ“ä½œéœ€è¦ï¼‰
  `version` INT DEFAULT 0 COMMENT 'ç‰ˆæœ¬å·',
  PRIMARY KEY (`id`),
  KEY `idx_user_parent` (`user_id`, `parent_id`, `deleted`),
  KEY `idx_file_md5` (`file_md5`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COMMENT='æ–‡ä»¶ä¿¡æ¯è¡¨';
```

---

## ğŸ”„ å‰åç«¯åˆ†ç¦»æ–¹æ¡ˆ

### 1. å‰åç«¯åˆ†ç¦»æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯åº”ç”¨       â”‚         â”‚   åç«¯åº”ç”¨       â”‚
â”‚   (Vue 3)       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”‚  (Spring Boot)  â”‚
â”‚                 â”‚  HTTPS  â”‚                 â”‚
â”‚  - ç”¨æˆ·ç•Œé¢     â”‚  RESTfulâ”‚  - ä¸šåŠ¡é€»è¾‘     â”‚
â”‚  - è·¯ç”±ç®¡ç†     â”‚   API   â”‚  - æ•°æ®å¤„ç†     â”‚
â”‚  - çŠ¶æ€ç®¡ç†     â”‚         â”‚  - æ•°æ®åº“è®¿é—®   â”‚
â”‚  - HTTPè¯·æ±‚     â”‚         â”‚  - æ–‡ä»¶å­˜å‚¨     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                           â”‚
        â”‚                           â”‚
        â–¼                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Nginx         â”‚         â”‚    MySQL        â”‚
â”‚   é™æ€èµ„æºæœåŠ¡   â”‚         â”‚    æ•°æ®å­˜å‚¨      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2. å‰ç«¯é¡¹ç›®ç»“æ„

```
cloud-disk-frontend/
â”œâ”€â”€ public/
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ api/                        # APIæ¥å£å°è£…
â”‚   â”‚   â”œâ”€â”€ modules/                # æŒ‰æ¨¡å—åˆ†ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts             # è®¤è¯æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ file.ts             # æ–‡ä»¶æ¥å£
â”‚   â”‚   â”‚   â”œâ”€â”€ user.ts             # ç”¨æˆ·æ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ share.ts            # åˆ†äº«æ¥å£
â”‚   â”‚   â”œâ”€â”€ request.ts              # Axioså°è£…
â”‚   â”‚   â””â”€â”€ types.ts                # æ¥å£ç±»å‹å®šä¹‰
â”‚   â”‚
â”‚   â”œâ”€â”€ assets/                     # é™æ€èµ„æº
â”‚   â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â”œâ”€â”€ icons/
â”‚   â”‚   â””â”€â”€ styles/
â”‚   â”‚       â”œâ”€â”€ index.scss          # å…¨å±€æ ·å¼
â”‚   â”‚       â”œâ”€â”€ variables.scss      # å˜é‡
â”‚   â”‚       â””â”€â”€ mixins.scss         # æ··åˆ
â”‚   â”‚
â”‚   â”œâ”€â”€ components/                 # å…¬å…±ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ common/                 # é€šç”¨ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ AppHeader.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ AppFooter.vue
â”‚   â”‚   â”‚   â””â”€â”€ Loading.vue
â”‚   â”‚   â”œâ”€â”€ file/                   # æ–‡ä»¶ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ FileList.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ FileItem.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ FileUpload.vue
â”‚   â”‚   â”‚   â””â”€â”€ FilePreview.vue
â”‚   â”‚   â””â”€â”€ user/                   # ç”¨æˆ·ç›¸å…³ç»„ä»¶
â”‚   â”‚       â””â”€â”€ UserAvatar.vue
â”‚   â”‚
â”‚   â”œâ”€â”€ composables/                # ç»„åˆå¼å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ useAuth.ts              # è®¤è¯é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ useFile.ts              # æ–‡ä»¶æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ useUpload.ts            # ä¸Šä¼ é€»è¾‘
â”‚   â”‚   â””â”€â”€ usePermission.ts        # æƒé™æ§åˆ¶
â”‚   â”‚
â”‚   â”œâ”€â”€ directives/                 # è‡ªå®šä¹‰æŒ‡ä»¤
â”‚   â”‚   â”œâ”€â”€ loading.ts
â”‚   â”‚   â””â”€â”€ permission.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ layouts/                    # å¸ƒå±€ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ DefaultLayout.vue       # é»˜è®¤å¸ƒå±€
â”‚   â”‚   â”œâ”€â”€ UserLayout.vue          # ç”¨æˆ·ç«¯å¸ƒå±€
â”‚   â”‚   â””â”€â”€ AdminLayout.vue         # ç®¡ç†ç«¯å¸ƒå±€
â”‚   â”‚
â”‚   â”œâ”€â”€ router/                     # è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ index.ts                # è·¯ç”±é…ç½®
â”‚   â”‚   â”œâ”€â”€ routes.ts               # è·¯ç”±å®šä¹‰
â”‚   â”‚   â””â”€â”€ guards.ts               # è·¯ç”±å®ˆå«
â”‚   â”‚
â”‚   â”œâ”€â”€ stores/                     # çŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ index.ts
â”‚   â”‚   â”œâ”€â”€ modules/
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts             # è®¤è¯çŠ¶æ€
â”‚   â”‚   â”‚   â”œâ”€â”€ user.ts             # ç”¨æˆ·çŠ¶æ€
â”‚   â”‚   â”‚   â”œâ”€â”€ file.ts             # æ–‡ä»¶çŠ¶æ€
â”‚   â”‚   â”‚   â””â”€â”€ app.ts              # åº”ç”¨çŠ¶æ€
â”‚   â”‚   â””â”€â”€ types.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ types/                      # TypeScriptç±»å‹
â”‚   â”‚   â”œâ”€â”€ api.ts                  # APIç±»å‹
â”‚   â”‚   â”œâ”€â”€ file.ts                 # æ–‡ä»¶ç±»å‹
â”‚   â”‚   â”œâ”€â”€ user.ts                 # ç”¨æˆ·ç±»å‹
â”‚   â”‚   â””â”€â”€ common.ts               # é€šç”¨ç±»å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ utils/                      # å·¥å…·å‡½æ•°
â”‚   â”‚   â”œâ”€â”€ request.ts              # è¯·æ±‚å·¥å…·
â”‚   â”‚   â”œâ”€â”€ storage.ts              # æœ¬åœ°å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ file.ts                 # æ–‡ä»¶å·¥å…·
â”‚   â”‚   â”œâ”€â”€ format.ts               # æ ¼å¼åŒ–
â”‚   â”‚   â”œâ”€â”€ validate.ts             # éªŒè¯
â”‚   â”‚   â””â”€â”€ crypto.ts               # åŠ å¯†
â”‚   â”‚
â”‚   â”œâ”€â”€ views/                      # é¡µé¢
â”‚   â”‚   â”œâ”€â”€ auth/                   # è®¤è¯é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ Login.vue
â”‚   â”‚   â”‚   â””â”€â”€ Register.vue
â”‚   â”‚   â”œâ”€â”€ user/                   # ç”¨æˆ·ç«¯é¡µé¢
â”‚   â”‚   â”‚   â”œâ”€â”€ Home.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ FileManage.vue
â”‚   â”‚   â”‚   â”œâ”€â”€ Share.vue
â”‚   â”‚   â”‚   â””â”€â”€ Profile.vue
â”‚   â”‚   â””â”€â”€ admin/                  # ç®¡ç†ç«¯é¡µé¢
â”‚   â”‚       â”œâ”€â”€ Dashboard.vue
â”‚   â”‚       â”œâ”€â”€ UserManage.vue
â”‚   â”‚       â””â”€â”€ SystemSetting.vue
â”‚   â”‚
â”‚   â”œâ”€â”€ App.vue                     # æ ¹ç»„ä»¶
â”‚   â””â”€â”€ main.ts                     # å…¥å£æ–‡ä»¶
â”‚
â”œâ”€â”€ .env.development                # å¼€å‘ç¯å¢ƒå˜é‡
â”œâ”€â”€ .env.production                 # ç”Ÿäº§ç¯å¢ƒå˜é‡
â”œâ”€â”€ .eslintrc.js                    # ESLinté…ç½®
â”œâ”€â”€ .prettierrc.js                  # Prettieré…ç½®
â”œâ”€â”€ tsconfig.json                   # TypeScripté…ç½®
â”œâ”€â”€ vite.config.ts                  # Viteé…ç½®
â””â”€â”€ package.json                    # ä¾èµ–é…ç½®
```

### 3. å‰åç«¯æ¥å£çº¦å®š

#### 3.1 è¯·æ±‚æ ¼å¼
```typescript
// POST /api/auth/login
{
  "username": "admin",
  "password": "admin123"
}
```

#### 3.2 å“åº”æ ¼å¼
```typescript
// æˆåŠŸå“åº”
{
  "code": 200,
  "message": "success",
  "data": {
    "accessToken": "eyJhbGc...",
    "userInfo": {...}
  },
  "timestamp": 1699000000000
}

// å¤±è´¥å“åº”
{
  "code": 400,
  "message": "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯",
  "data": null,
  "timestamp": 1699000000000
}
```

#### 3.3 åˆ†é¡µæ ¼å¼
```typescript
// è¯·æ±‚
GET /api/files?pageNum=1&pageSize=20&sortBy=time&sortOrder=desc

// å“åº”
{
  "code": 200,
  "message": "success",
  "data": {
    "total": 100,
    "pageNum": 1,
    "pageSize": 20,
    "totalPages": 5,
    "records": [...]
  }
}
```

### 4. å‰ç«¯å¼€å‘è§„èŒƒ

#### 4.1 APIè¯·æ±‚å°è£…
```typescript
// src/api/request.ts
import axios, { AxiosInstance } from 'axios'
import { useAuthStore } from '@/stores/auth'
import { ElMessage } from 'element-plus'

const service: AxiosInstance = axios.create({
  baseURL: import.meta.env.VITE_API_BASE_URL,
  timeout: 30000
})

// è¯·æ±‚æ‹¦æˆªå™¨
service.interceptors.request.use(
  (config) => {
    const authStore = useAuthStore()
    if (authStore.token) {
      config.headers.Authorization = `Bearer ${authStore.token}`
    }
    return config
  },
  (error) => Promise.reject(error)
)

// å“åº”æ‹¦æˆªå™¨
service.interceptors.response.use(
  (response) => {
    const { code, message, data } = response.data
    if (code === 200) {
      return data
    } else {
      ElMessage.error(message)
      return Promise.reject(new Error(message))
    }
  },
  (error) => {
    // å¤„ç†401ã€403ç­‰é”™è¯¯
    return Promise.reject(error)
  }
)

export default service
```

#### 4.2 APIæ¨¡å—å°è£…
```typescript
// src/api/modules/file.ts
import request from '../request'
import type { FileInfo, FileListParams, FileListResponse } from '@/types/file'

export const fileApi = {
  // è·å–æ–‡ä»¶åˆ—è¡¨
  getFileList(params: FileListParams): Promise<FileListResponse> {
    return request.get('/files', { params })
  },
  
  // ä¸Šä¼ æ–‡ä»¶
  uploadFile(formData: FormData): Promise<FileInfo> {
    return request.post('/files/upload', formData, {
      headers: { 'Content-Type': 'multipart/form-data' }
    })
  },
  
  // åˆ é™¤æ–‡ä»¶
  deleteFile(fileId: number): Promise<void> {
    return request.delete(`/files/${fileId}`)
  }
}
```

### 5. å¼€å‘è°ƒè¯•æ–¹æ¡ˆ

#### 5.1 æœ¬åœ°å¼€å‘ç¯å¢ƒ
```yaml
# åç«¯: http://localhost:8080
# å‰ç«¯: http://localhost:3000
# å‰ç«¯é€šè¿‡Viteä»£ç†è®¿é—®åç«¯API

# vite.config.ts
export default defineConfig({
  server: {
    port: 3000,
    proxy: {
      '/api': {
        target: 'http://localhost:8080',
        changeOrigin: true
      }
    }
  }
})
```

#### 5.2 Mockæ•°æ®ï¼ˆå¯é€‰ï¼‰
```typescript
// src/mock/file.ts
import { MockMethod } from 'vite-plugin-mock'

export default [
  {
    url: '/api/files',
    method: 'get',
    response: () => {
      return {
        code: 200,
        message: 'success',
        data: {
          total: 10,
          records: [...]
        }
      }
    }
  }
] as MockMethod[]
```

---

## ğŸ“‹ å®Œæ•´é¡¹ç›®ç»“æ„ï¼ˆæœ€ç»ˆç‰ˆï¼‰

### åç«¯é¡¹ç›®ç»“æ„

```
cloud-disk-backend/
â”œâ”€â”€ src/main/java/com/noname/background/
â”‚   â”‚
â”‚   â”œâ”€â”€ interface/                          # æ¥å£å±‚
â”‚   â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthController.java         # è®¤è¯æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ FileController.java         # æ–‡ä»¶æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ UserController.java         # ç”¨æˆ·æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ ShareController.java        # åˆ†äº«æ§åˆ¶å™¨
â”‚   â”‚   â”‚   â””â”€â”€ admin/                      # ç®¡ç†ç«¯æ§åˆ¶å™¨
â”‚   â”‚   â”‚       â”œâ”€â”€ AdminUserController.java
â”‚   â”‚   â”‚       â”œâ”€â”€ AdminFileController.java
â”‚   â”‚   â”‚       â””â”€â”€ AdminSystemController.java
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ dto/                            # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚       â”œâ”€â”€ request/                    # è¯·æ±‚DTO
â”‚   â”‚       â”‚   â”œâ”€â”€ LoginRequest.java
â”‚   â”‚       â”‚   â”œâ”€â”€ RegisterRequest.java
â”‚   â”‚       â”‚   â”œâ”€â”€ FileUploadRequest.java
â”‚   â”‚       â”‚   â””â”€â”€ CreateShareRequest.java
â”‚   â”‚       â””â”€â”€ response/                   # å“åº”DTO
â”‚   â”‚           â”œâ”€â”€ LoginResponse.java
â”‚   â”‚           â”œâ”€â”€ FileResponse.java
â”‚   â”‚           â”œâ”€â”€ ShareResponse.java
â”‚   â”‚           â””â”€â”€ UserProfileResponse.java
â”‚   â”‚
â”‚   â”œâ”€â”€ application/                        # åº”ç”¨å±‚
â”‚   â”‚   â”œâ”€â”€ service/                        # åº”ç”¨æœåŠ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ AuthService.java
â”‚   â”‚   â”‚   â”œâ”€â”€ FileService.java
â”‚   â”‚   â”‚   â”œâ”€â”€ UserService.java
â”‚   â”‚   â”‚   â””â”€â”€ ShareService.java
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ assembler/                      # è£…é…å™¨ï¼ˆDTOè½¬æ¢ï¼‰
â”‚   â”‚       â”œâ”€â”€ UserAssembler.java
â”‚   â”‚       â”œâ”€â”€ FileAssembler.java
â”‚   â”‚       â””â”€â”€ ShareAssembler.java
â”‚   â”‚
â”‚   â”œâ”€â”€ domain/                             # é¢†åŸŸå±‚
â”‚   â”‚   â”œâ”€â”€ user/                           # ç”¨æˆ·åŸŸ
â”‚   â”‚   â”‚   â”œâ”€â”€ entity/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ User.java
â”‚   â”‚   â”‚   â”œâ”€â”€ valueobject/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserType.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ UserStatus.java
â”‚   â”‚   â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ UserDomainService.java
â”‚   â”‚   â”‚   â””â”€â”€ repository/
â”‚   â”‚   â”‚       â””â”€â”€ UserRepository.java
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ file/                           # æ–‡ä»¶åŸŸ
â”‚   â”‚   â”‚   â”œâ”€â”€ entity/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FileInfo.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ Folder.java
â”‚   â”‚   â”‚   â”œâ”€â”€ valueobject/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FileType.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FilePath.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ FileSize.java
â”‚   â”‚   â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FileDomainService.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ StorageDomainService.java
â”‚   â”‚   â”‚   â””â”€â”€ repository/
â”‚   â”‚   â”‚       â””â”€â”€ FileRepository.java
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ share/                          # åˆ†äº«åŸŸ
â”‚   â”‚       â”œâ”€â”€ entity/
â”‚   â”‚       â”‚   â””â”€â”€ FileShare.java
â”‚   â”‚       â”œâ”€â”€ valueobject/
â”‚   â”‚       â”‚   â”œâ”€â”€ ShareCode.java
â”‚   â”‚       â”‚   â”œâ”€â”€ SharePassword.java
â”‚   â”‚       â”‚   â””â”€â”€ ShareStatus.java
â”‚   â”‚       â”œâ”€â”€ service/
â”‚   â”‚       â”‚   â””â”€â”€ ShareDomainService.java
â”‚   â”‚       â””â”€â”€ repository/
â”‚   â”‚           â””â”€â”€ ShareRepository.java
â”‚   â”‚
â”‚   â”œâ”€â”€ infrastructure/                     # åŸºç¡€è®¾æ–½å±‚
â”‚   â”‚   â”œâ”€â”€ persistence/                    # æŒä¹…åŒ–
â”‚   â”‚   â”‚   â”œâ”€â”€ mapper/                     # MyBatis Mapper
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserMapper.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ FileMapper.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ShareMapper.java
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ repository/                 # ä»“å‚¨å®ç°
â”‚   â”‚   â”‚       â”œâ”€â”€ UserRepositoryImpl.java
â”‚   â”‚   â”‚       â”œâ”€â”€ FileRepositoryImpl.java
â”‚   â”‚   â”‚       â””â”€â”€ ShareRepositoryImpl.java
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ storage/                        # æ–‡ä»¶å­˜å‚¨
â”‚   â”‚   â”‚   â”œâ”€â”€ StorageService.java
â”‚   â”‚   â”‚   â”œâ”€â”€ impl/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LocalStorageServiceImpl.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ AliyunOssStorageServiceImpl.java
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ TencentCosStorageServiceImpl.java
â”‚   â”‚   â”‚   â””â”€â”€ factory/
â”‚   â”‚   â”‚       â””â”€â”€ StorageServiceFactory.java
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ config/                         # é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ SecurityConfig.java         # å®‰å…¨é…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ SwaggerConfig.java          # Swaggeré…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ MyBatisConfig.java          # MyBatisé…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ RedisConfig.java            # Redisé…ç½®
â”‚   â”‚   â”‚   â”œâ”€â”€ WebConfig.java              # Webé…ç½®
â”‚   â”‚   â”‚   â””â”€â”€ JwtProperties.java          # JWTå±æ€§
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ common/                         # å…¬å…±ç»„ä»¶
â”‚   â”‚       â”œâ”€â”€ base/                       # åŸºç±»
â”‚   â”‚       â”‚   â”œâ”€â”€ BaseEntity.java         # åŸºç¡€å®ä½“
â”‚   â”‚       â”‚   â”œâ”€â”€ AuditEntity.java        # å®¡è®¡å®ä½“
â”‚   â”‚       â”‚   â””â”€â”€ VersionEntity.java      # ç‰ˆæœ¬å®ä½“
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ constant/                   # å¸¸é‡
â”‚   â”‚       â”‚   â”œâ”€â”€ ErrorCode.java          # é”™è¯¯ç 
â”‚   â”‚       â”‚   â””â”€â”€ CommonConstant.java     # é€šç”¨å¸¸é‡
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ exception/                  # å¼‚å¸¸
â”‚   â”‚       â”‚   â”œâ”€â”€ BusinessException.java
â”‚   â”‚       â”‚   â””â”€â”€ GlobalExceptionHandler.java
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ result/                     # å“åº”
â”‚   â”‚       â”‚   â”œâ”€â”€ Result.java             # ç»Ÿä¸€å“åº”
â”‚   â”‚       â”‚   â””â”€â”€ PageResult.java         # åˆ†é¡µå“åº”
â”‚   â”‚       â”‚
â”‚   â”‚       â”œâ”€â”€ utils/                      # å·¥å…·ç±»
â”‚   â”‚       â”‚   â”œâ”€â”€ JwtUtil.java            # JWTå·¥å…·
â”‚   â”‚       â”‚   â”œâ”€â”€ FileUtil.java           # æ–‡ä»¶å·¥å…·
â”‚   â”‚       â”‚   â”œâ”€â”€ RedisUtil.java          # Rediså·¥å…·
â”‚   â”‚       â”‚   â””â”€â”€ SecurityUtil.java       # å®‰å…¨å·¥å…·
â”‚   â”‚       â”‚
â”‚   â”‚       â””â”€â”€ aspect/                     # åˆ‡é¢
â”‚   â”‚           â”œâ”€â”€ LogAspect.java          # æ—¥å¿—åˆ‡é¢
â”‚   â”‚           â””â”€â”€ PermissionAspect.java   # æƒé™åˆ‡é¢
â”‚   â”‚
â”‚   â””â”€â”€ BackgroundApplication.java          # å¯åŠ¨ç±»
â”‚
â”œâ”€â”€ src/main/resources/
â”‚   â”œâ”€â”€ mapper/                             # MyBatisæ˜ å°„æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ UserMapper.xml
â”‚   â”‚   â”œâ”€â”€ FileMapper.xml
â”‚   â”‚   â””â”€â”€ ShareMapper.xml
â”‚   â”‚
â”‚   â”œâ”€â”€ db/                                 # æ•°æ®åº“è„šæœ¬
â”‚   â”‚   â”œâ”€â”€ init.sql                        # åˆå§‹åŒ–è„šæœ¬
â”‚   â”‚   â””â”€â”€ data.sql                        # æµ‹è¯•æ•°æ®
â”‚   â”‚
â”‚   â”œâ”€â”€ application.yml                     # ä¸»é…ç½®
â”‚   â”œâ”€â”€ application-dev.yml                 # å¼€å‘ç¯å¢ƒ
â”‚   â”œâ”€â”€ application-prod.yml                # ç”Ÿäº§ç¯å¢ƒ
â”‚   â”œâ”€â”€ logback-spring.xml                  # æ—¥å¿—é…ç½®
â”‚   â””â”€â”€ static/                             # é™æ€èµ„æº
â”‚
â””â”€â”€ pom.xml                                 # Mavené…ç½®
```

---

## ğŸ“ å¼€å‘è§„èŒƒ

### 1. å‘½åè§„èŒƒ

#### 1.1 Javaå‘½å
```java
// ç±»åï¼šå¤§é©¼å³°
public class UserDomainService {}

// æ¥å£åï¼šIå¼€å¤´æˆ–ä¸åŠ å‰ç¼€
public interface UserRepository {}

// æ–¹æ³•åï¼šå°é©¼å³°ï¼ŒåŠ¨è¯å¼€å¤´
public void createUser() {}

// å˜é‡åï¼šå°é©¼å³°
private String userName;

// å¸¸é‡ï¼šå…¨å¤§å†™ï¼Œä¸‹åˆ’çº¿åˆ†éš”
public static final String DEFAULT_USER_TYPE = "NORMAL";

// åŒ…åï¼šå…¨å°å†™ï¼Œç‚¹åˆ†éš”
package com.noname.background.domain.user;
```

#### 1.2 æ•°æ®åº“å‘½å
```sql
-- è¡¨åï¼šå°å†™ï¼Œä¸‹åˆ’çº¿åˆ†éš”
sys_user, file_info, file_share

-- å­—æ®µåï¼šå°å†™ï¼Œä¸‹åˆ’çº¿åˆ†éš”
user_name, create_time, file_size

-- ç´¢å¼•åï¼šidx_å¼€å¤´
idx_user_id, idx_create_time

-- å”¯ä¸€ç´¢å¼•ï¼šuk_å¼€å¤´
uk_username, uk_email
```

### 2. ä»£ç æ³¨é‡Šè§„èŒƒ

```java
/**
 * ç”¨æˆ·é¢†åŸŸæœåŠ¡
 * 
 * @author YourName
 * @since 2025-01-01
 */
@Service
public class UserDomainService {
    
    /**
     * åˆ›å»ºç”¨æˆ·
     * 
     * @param user ç”¨æˆ·ä¿¡æ¯
     * @return ç”¨æˆ·ID
     * @throws BusinessException ä¸šåŠ¡å¼‚å¸¸
     */
    public Long createUser(User user) {
        // 1. å‚æ•°æ ¡éªŒ
        validateUser(user);
        
        // 2. ä¸šåŠ¡é€»è¾‘
        // ...
        
        return user.getId();
    }
}
```

### 3. å¼‚å¸¸å¤„ç†è§„èŒƒ

```java
// ä¸šåŠ¡å¼‚å¸¸
throw new BusinessException("ç”¨æˆ·åå·²å­˜åœ¨");
throw new BusinessException(ErrorCode.USER_EXISTS, "ç”¨æˆ·åå·²å­˜åœ¨");

// Controllerå±‚ç»Ÿä¸€å¤„ç†
@RestControllerAdvice
public class GlobalExceptionHandler {
    @ExceptionHandler(BusinessException.class)
    public Result<?> handleBusinessException(BusinessException e) {
        return Result.fail(e.getCode(), e.getMessage());
    }
}
```

### 4. æ—¥å¿—è§„èŒƒ

```java
@Slf4j
public class UserService {
    
    public void createUser(User user) {
        log.debug("å¼€å§‹åˆ›å»ºç”¨æˆ·: {}", user.getUsername());
        
        try {
            // ä¸šåŠ¡é€»è¾‘
            log.info("ç”¨æˆ·åˆ›å»ºæˆåŠŸ: {}", user.getId());
        } catch (Exception e) {
            log.error("ç”¨æˆ·åˆ›å»ºå¤±è´¥", e);
            throw e;
        }
    }
}
```

---

## ğŸ¯ æ€»ç»“

è¿™å¥—ç»ˆææ¶æ„è®¾è®¡æ–¹æ¡ˆæä¾›äº†ï¼š

### âœ… æ ¸å¿ƒç‰¹æ€§
1. **DDDé¢†åŸŸé©±åŠ¨è®¾è®¡** - æ¸…æ™°çš„åˆ†å±‚æ¶æ„å’Œé¢†åŸŸåˆ’åˆ†
2. **å…¬å…±å­—æ®µè®¾è®¡** - BaseEntityã€AuditEntityã€VersionEntity
3. **å‰åç«¯åˆ†ç¦»** - å®Œæ•´çš„æ¥å£è§„èŒƒå’Œé¡¹ç›®ç»“æ„
4. **Swaggeræ–‡æ¡£** - è‡ªåŠ¨ç”ŸæˆAPIæ–‡æ¡£ï¼Œæ–¹ä¾¿æµ‹è¯•
5. **MyBatisè‡ªåŠ¨å¡«å……** - è‡ªåŠ¨å¡«å……åˆ›å»ºæ—¶é—´ã€æ›´æ–°äººç­‰å­—æ®µ

### âœ… ä¼ä¸šçº§ç‰¹æ€§
- ç»Ÿä¸€å“åº”æ ¼å¼
- ç»Ÿä¸€å¼‚å¸¸å¤„ç†
- å‚æ•°è‡ªåŠ¨æ ¡éªŒ
- ä¹è§‚é”æ”¯æŒ
- é€»è¾‘åˆ é™¤
- æ“ä½œå®¡è®¡
- æ—¥å¿—è§„èŒƒ

### âœ… å¼€å‘æ•ˆç‡
- ä»£ç ç»“æ„æ¸…æ™°
- èŒè´£åˆ’åˆ†æ˜ç¡®
- æ˜“äºç»´æŠ¤æ‰©å±•
- ä¾¿äºå›¢é˜Ÿåä½œ

---

**è¿™æ˜¯æœ€ç»ˆç‰ˆæœ¬çš„æ¶æ„è®¾è®¡ï¼æ¥ä¸‹æ¥æˆ‘ä»¬å¯ä»¥æŒ‰ç…§è¿™ä¸ªæ–¹æ¡ˆå¼€å§‹ç¼–ç å®ç°ã€‚**

*æœ€åæ›´æ–°: 2025-01-01*

