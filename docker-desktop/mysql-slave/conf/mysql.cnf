[mysqld]
# *************** 基础配置 *************** #
server-id = 2
port = 3306
datadir = /var/lib/mysql
socket = /var/run/mysqld/mysqld.sock
pid-file = /var/run/mysqld/mysqld.pid

# *************** 字符集配置 *************** #
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
init_connect = 'SET NAMES utf8mb4'

# *************** 二进制日志配置 *************** #
log_bin = mysql-bin
binlog_format = ROW
binlog_expire_logs_seconds = 604800  # 7天
max_binlog_size = 100M

# *************** 复制配置 (MySQL 8.0 新语法) *************** #
gtid_mode = ON
enforce_gtid_consistency = ON
log_replica_updates = ON  # 替代 log_slave_updates
relay_log = mysql-relay-bin
read_only = 1

# *************** 从库特有配置 *************** #
relay_log_index = mysql-relay-bin.index
relay_log_info_repository = TABLE
master_info_repository = TABLE

# *************** 性能优化 *************** #
innodb_buffer_pool_size = 1G
innodb_redo_log_capacity = 1G  # 替代 innodb_log_file_size
innodb_log_buffer_size = 16M
innodb_flush_log_at_trx_commit = 2
innodb_file_per_table = ON
innodb_flush_method = O_DIRECT

# *************** 连接配置 *************** #
max_connections = 500
thread_cache_size = 16
table_open_cache = 2000
host_cache_size = 0  # 替代 skip-host-cache

# *************** 从库复制优化 (MySQL 8.0 新语法) *************** #
replica_parallel_workers = 4  # 替代 slave_parallel_workers
replica_parallel_type = LOGICAL_CLOCK
replica_preserve_commit_order = 1  # 替代 slave_preserve_commit_order

# *************** 其他配置 *************** #
skip_name_resolve = 1
authentication_policy = 'mysql_native_password,'  # 替代 default_authentication_plugin

# *************** 错误日志 *************** #
log_error = /var/log/mysql/mysql-error.log

# *************** 慢查询日志 *************** #
slow_query_log = 1
slow_query_log_file = /var/log/mysql/mysql-slow.log
long_query_time = 2
log_queries_not_using_indexes = 0

# *************** 安全配置 *************** #
secure_file_priv = /var/lib/mysql-files

[mysql]
default-character-set = utf8mb4

[client]
default-character-set = utf8mb4